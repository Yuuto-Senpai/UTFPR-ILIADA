import subprocess
import base64
import os
import time

def test_signature():
    # Gera uma assinatura falsa (aleatória) em Base64
    random_signature = base64.b64encode(os.urandom(64)).decode('utf-8')
    
    # Executa o JAR com a assinatura aleatória
    process = subprocess.Popen(['java', '-jar', 'desafio.jar'], stdin=subprocess.PIPE, stdout=subprocess.PIPE)
    output, _ = process.communicate(input=random_signature.encode())

    # Checa a saída do programa
    if "ParabVocconseguiu" in output.decode():
        print("⚠️  ASSINATURA ACEITA! ⚠️")
        print("Assinatura base64 aceita:", random_signature)
        # Aqui podemos adicionar um som ou notificação visual
        print("\a")  # Emite um som (beep) no terminal como alerta
        return True
    return False

# Loop para testar várias assinaturas
for i in range(10000):
    print(f"Tentativa {i + 1}")
    if test_signature():
        break
    time.sleep(0.1)  # Atraso de 0.5 segundos entre as tentativas
